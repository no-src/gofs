name: test for gofs local disk with sync once
init:
  - mkdir:
    source: ./source-sync-once
  - mkdir:
    source: ./dest-sync-once
  - mkdir:
    source: ./source-sync-once/content/inner
  - cp:
    source: ./integration_test.go
    dest: ./source-sync-once/content/inner/integration_test.go.bak2
  - cp:
    source: ./integration_test.go
    dest: ./source-sync-once/integration_test.go.bak
  - symlink:
    link: ./source-sync-once/integration_test.go.bak.symlink
    dest: ./integration_test.go.bak
  - symlink:
    link: ./source-sync-once/integration_test.go.bak_symlink.symlink
    dest: ./integration_test.go.bak.symlink
  - symlink:
    link: ./source-sync-once/current.notfound.symlink
    dest: ./current.notfound
  - symlink:
    link: ./source-sync-once/outer.notfound.symlink
    dest: ../outer.notfound
  - symlink:
    link: ./source-sync-once/outer_file.symlink
    dest: ../integration_test.go
  - symlink:
    link: ./source-sync-once/outer_dir.symlink
    dest: ../testdata
  - symlink:
    link: ./source-sync-once/content.symlink
    dest: ./content
  - symlink:
    link: ./source-sync-once/content_symlink.symlink
    dest: ./content.symlink
actions:
  - sleep: 10s
  - is-equal:
    source: ./integration_test.go
    dest: ./dest-sync-once/integration_test.go.bak
    expect: true
    must-non-empty: true
  - is-equal:
    source: ./integration_test.go
    dest: ./dest-sync-once/content/inner/integration_test.go.bak2
    expect: true
    must-non-empty: true
  - is-symlink:
    link: ./dest-sync-once/integration_test.go.bak.symlink
    expect: true
  - is-symlink:
    link: ./dest-sync-once/integration_test.go.bak_symlink.symlink
    expect: true
  - is-symlink:
    link: ./dest-sync-once/current.notfound.symlink
    expect: true
  - is-symlink:
    link: ./dest-sync-once/outer.notfound.symlink
    expect: true
  - is-symlink:
    link: ./dest-sync-once/outer_file.symlink
    expect: true
  - is-symlink:
    link: ./dest-sync-once/outer_dir.symlink
    expect: true
  - is-symlink:
    link: ./dest-sync-once/content.symlink
    expect: true
  - is-dir:
    source: ./dest-sync-once/content.symlink/inner
    expect: true
  - is-equal:
    source: ./source-sync-once/content/inner/integration_test.go.bak2
    dest: ./dest-sync-once/content.symlink/inner/integration_test.go.bak2
    expect: true
    must-non-empty: true
  - is-symlink:
    link: ./dest-sync-once/content_symlink.symlink
    expect: true
clear:
  - rm:
    source: ./source-sync-once
  - rm:
    source: ./dest-sync-once