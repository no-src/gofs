name: test for gofs local disk with copy unsafe link
init:
  - mkdir:
    source: ./source-copy-unsafe-link
  - mkdir:
    source: ./dest-copy-unsafe-link
  - mkdir:
    source: ./source-copy-unsafe-link/content/inner
  - cp:
    source: ./integration_test.go
    dest: ./source-copy-unsafe-link/content/inner/integration_test.go.bak2
  - cp:
    source: ./integration_test.go
    dest: ./source-copy-unsafe-link/integration_test.go.bak
  - symlink:
    link: ./source-copy-unsafe-link/integration_test.go.bak.symlink
    dest: ./integration_test.go.bak
  - symlink:
    link: ./source-copy-unsafe-link/integration_test.go.bak_symlink.symlink
    dest: ./integration_test.go.bak.symlink
  - symlink:
    link: ./source-copy-unsafe-link/current.notfound.symlink
    dest: ./current.notfound
  - symlink:
    link: ./source-copy-unsafe-link/outer.notfound.symlink
    dest: ../outer.notfound
  - symlink:
    link: ./source-copy-unsafe-link/outer_file.symlink
    dest: ../integration_test.go
  - symlink:
    link: ./source-copy-unsafe-link/outer_dir.symlink
    dest: ../testdata
  - symlink:
    link: ./source-copy-unsafe-link/content.symlink
    dest: ./content
  - symlink:
    link: ./source-copy-unsafe-link/content_symlink.symlink
    dest: ./content.symlink
actions:
  - sleep: 10s
  - is-equal:
    source: ./integration_test.go
    dest: ./dest-copy-unsafe-link/integration_test.go.bak
    expect: true
    must-non-empty: true
  - is-equal:
    source: ./integration_test.go
    dest: ./dest-copy-unsafe-link/content/inner/integration_test.go.bak2
    expect: true
    must-non-empty: true
  - is-equal:
    source: ./source-copy-unsafe-link/integration_test.go.bak
    dest: ./dest-copy-unsafe-link/integration_test.go.bak.symlink
    expect: true
    must-non-empty: true
  - is-symlink:
    link: ./dest-copy-unsafe-link/integration_test.go.bak_symlink.symlink
    expect: true
  - is-symlink:
    link: ./dest-copy-unsafe-link/current.notfound.symlink
    expect: true
  - is-symlink:
    link: ./dest-copy-unsafe-link/outer.notfound.symlink
    expect: true
  - is-equal:
    source: ./integration_test.go
    dest: ./dest-copy-unsafe-link/outer_file.symlink
    expect: true
    must-non-empty: true
  - is-dir:
    source: ./dest-copy-unsafe-link/outer_dir.symlink
    expect: true
  - is-equal:
    source: ./testdata/test/test-gofs-local-disk-copy-unsafe-link.yaml
    dest: ./dest-copy-unsafe-link/outer_dir.symlink/test/test-gofs-local-disk-copy-unsafe-link.yaml
    expect: true
    must-non-empty: true
  - is-dir:
    source: ./dest-copy-unsafe-link/content.symlink
    expect: true
  - is-dir:
    source: ./dest-copy-unsafe-link/content.symlink/inner
    expect: true
  - is-equal:
    source: ./source-copy-unsafe-link/content/inner/integration_test.go.bak2
    dest: ./dest-copy-unsafe-link/content.symlink/inner/integration_test.go.bak2
    expect: true
    must-non-empty: true
  - is-symlink:
    link: ./dest-copy-unsafe-link/content_symlink.symlink
    expect: true
clear:
  - rm:
    source: ./source-copy-unsafe-link
  - rm:
    source: ./dest-copy-unsafe-link